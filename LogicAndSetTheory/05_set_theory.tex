\section{Set theory}

\subsection{Axioms of \texorpdfstring{$\mathsf{ZF}$}{ZF}}
In this section, we will attempt to understand the structure of the universe of sets.
In order to do this, we will treat set theory as a first-order theory like any other, and can therefore study it with our usual tools.
In particular, we will study a particular theory called \vocab{Zermelo--Fraenkel set theory}, denoted $\mathsf{ZF}$.
The language has $\Omega = \varnothing, \Pi = \qty{\in}, \alpha(\in) = 2$.
A `universe of sets' is simply a model $(V, \in_V) = (V, \in)$ for the axioms of $\mathsf{ZF}$.
We can view this section as a worked example of the concepts of predicate logic, but every model of $\mathsf{ZF}$ will contain a copy of (most of) mathematics, so they will be very complicated.

A structure is a set $V$ together with $[\in]_V \subset V \times V$.
An element of $V$ is called a `set'.
If $a, b \in V$ and $(a, b) \in [\in]_V$, say `$a$ belongs to $b$' or `$a$ is an element of $b$'.

We now define the axioms (there are 2 + 4 + 3 axioms) of $\mathsf{ZF}$ set theory.
\begin{enumerate}
    \item \vocab{Axiom of Extensionality (Ext)} \\
    `If two sets have the same members, then they are equal'
    \begin{align*}
        (\forall x)(\forall y)((\forall z)(z \in x \Leftrightarrow z \in y) \implies x = y)
    \end{align*}
    Note that the converse follows from the definition of equality.
    This implies that sets have no duplicate elements, and have no ordering.

    \item \vocab{Axiom of Separation (Sep)} or \vocab{Comprehension} \\
    `We can have subsets of sets'

    For a set $x$ and a property $p$, we can form the set of $z \in x$ s.t. $p(z)$ holds.
    \begin{align*}
        (\forall t_1)\dots(\forall t_n)(\forall x)(\exists y)(\forall z)(z \in y \Leftrightarrow z \in x \wedge p)
    \end{align*}
    where the $t_i$ are the parameters, and $p$ is a formula with $\FV(p) = \qty{z, t_1, \dots, t_n}$. \\
    By (Ext) the set $y$ who existence is asserted is unique, we denote it by $\qty{z \in x : p}$.
    (Formally we introduce an $(n + 1)$-arity operation symbol to the language; informally this is an abbreviation).

    \begin{example}
        Note that we need the parameters as we may wish to form the set $\qty{z \in x : z \in t}$ for some variable $t$.
    \end{example}
    \item \vocab{Empty-set Axiom (Emp)}
    \begin{align*}
        (\exists x)(\forall y)(\neg y \in x)
    \end{align*}
    This empty set is unique by extensionality and denoted by $\emptyset$.
    Formally, we add a constant $\emptyset$ to the language with the sentence $(\forall y)(\neg y \in \emptyset)$.

    \begin{example}
        For instance, $p(\varnothing)$ is the sentence $(\exists x)((\forall y)(\neg y \in x) \wedge p(x))$.
    \end{example}

    Strictly speaking, this axiom is not needed as it follows from (Sep).
    Indeed, in a structure $V$, we can pick any set $x$ and form the set $\{y \in x : \neg (y = y)\}$ by (Sep).
    However, if in first-order logic we allow the empty set as a structure, then (Emp) is needed (or some axiom asserting the existence of some set).
    \item \vocab{Pair-set Axiom (Pair)} \\
    `We can form unordered pairs'
    \begin{align*}
        (\forall x)(\forall y)(\exists z)(\forall t)((t \in z) \Leftrightarrow (t = x \vee t = y))
    \end{align*}
    We write $\qty{x, y}$ for this set $z$, which is unique by Ext.
    $(\forall x)(\forall y) (\qty{x, y} = \qty{y, x})$ can be proved.

    Some basic set-theoretic principles can now be defined.
    \begin{itemize}
        \item We write $\qty{x} = \qty{x, x}$ for the singleton set containing $x$.
        \item We can now define the ordered pair $(x, y) = \qty{\qty{x}, \qty{x, y}}$; from the axioms so far we can prove that $(\forall x) (\forall y) (\forall t) (\forall z) ((x, y) = (t, z) \iff (x = t \wedge y = z))$.
    \end{itemize}

    We introduce abbreviations
    \begin{itemize}
        \item ``$x$ is an ordered pair'' if $(\exists y)(\exists z)(x = (y,z))$.
        \item ``$f$ is a function'' if $(\forall x)(x \in f \implies x \text{ is an ordered pair}) \wedge (\forall x)(\forall y)(\forall z)((x,y) \in f \wedge (x,z) \in f \implies y = z)$
        \item We call a set $x$ the domain of $f$, written $x = \dom f$, if $f$ is a function and
        \begin{align*}
            (\forall y)(y \in x \Leftrightarrow (\exists z)((y,z) \in f))
        \end{align*}
        \item The notation $f \colon x \to y$ means that $f$ is a function, if $x = \dom f$ and
        \begin{align*}
            (\forall z)(\forall t)((z, t) \in f \implies t \in y)
        \end{align*}
    \end{itemize}

    \item \vocab{Union Axiom (Un)} \\
    For each family of sets $x$, we can form its union $\bigcup_{t \in x} t$.
    \begin{align*}
        (\forall x)(\exists y)(\forall z)(z \in y \Leftrightarrow (\exists t)(z \in t \wedge t \in x))
    \end{align*}
    The set $y$ guaranteed by this axiom can be written $\bigcup x$, and we can write $x \cup y$ for $\bigcup \qty{x, y}$.

    \begin{remark}
        No new axiom needed for intersection as this can be formed by (Sep)\footnote{This cannot be used to create empty intersections, as the (Sep) can only create subsets of a set that already exists.}.
        So the following line follows from the axioms so far:
        \begin{align*}
            (\forall x)(\neg x \in \emptyset \implies (\exists y)(\forall z)(z \in y \iff (\forall t)(t \in x \implies z \in t)))
        \end{align*}
        Denote set $y$ by $\cap x$.

        To prove this, given $x$, form $y = \qty{z \in \cup x : (\forall t)(t \in x \implies z \in t)}$ by (Sep).
        Check that $(\forall z)(z \in y \iff (\forall t)(t \in x \implies z \in t))$.

        Given $x, y$, denote $z \in \cap \qty{x, y} \iff (z \in x \wedge z \in y)$ by $z \in x \cap y$.
    \end{remark}

    \item \vocab{Power-set Axiom (Pow)} \\
    \begin{align*}
        (\forall x)(\exists y)(\forall z)(z \in y \Leftrightarrow z \subseteq x)
    \end{align*}
    where $z \subseteq x$ is an abbreviation for $(\forall t)(t \in z \implies t \in x)$.
    Denote $y$ by $\mathcal{P}(x)$.

    We can form the Cartesian product $x \times y$ for sets $x, y$: an element of $x \times y$ is an ordered pair $(s, t)$ where $s \in x$ and $t \in y$.
    Note that $(s, t) = \qty{\underbracket{\qty{x}}_{\in \mathcal{P}x}, \underbracket{\qty{x, y}}_{\in \mathcal{P}(x \cup y)}} \in \mathcal{P}(\mathcal{P}(x \cup y))$, so by (Sep) we can form $\{z \in \mathcal P(\mathcal P(x \cup y)) : (\exists s)(\exists t) (s \in x \wedge t \in y \wedge z = (s, t))\}$.

    We can also form, from sets $x, y$, $y^x = \qty{f \in \mathcal{P}(x \times y) : f : x \to y}$ which is the set of all functions from $x \to y$.

    \item \vocab{Axiom of Infinity (Inf)} \\
    Using our currently defined axioms, any model $V$ must be infinite, e.g. $\emptyset, \mathcal{P}\emptyset, \mathcal{P}\mathcal{P} \emptyset, \dots$ are all distinct elements of $V$.

    \begin{definition}[Successor]
        For a set $x$, the \vocab{successor} of $x$ is $x^+ = x \cup \qty{x}$.
    \end{definition}
    \begin{example}
        Then $\emptyset, \emptyset^+, \emptyset^{++}, \dots$ are distinct elements of $V$.
        \begin{align*}
            \varnothing^+ = \qty{\varnothing};\quad \varnothing^{++} = \qty{\varnothing, \qty{\varnothing}};\quad \varnothing^{+++} = \qty{\varnothing, \qty{\varnothing}, \qty{\varnothing, \qty{\varnothing}}};\quad \dots
        \end{align*}
    \end{example}

    We write $0 = \varnothing, 1 = \varnothing^+, 2 = \varnothing^{++}, \dots$ for the successors created in this way.
    For instance, $3 = \qty{0, 1, 2}$.
    We have a copy of $\mathbb{N}_0$ in $V$.
    From the outside, $V$ is infinite.
    From the inside, $V$ is not a set: $\neg(\exists x)(\forall y) (y \in x)$ (Russell's paradox) (If such $x$ exists, form $\qty{y \in x : \neg y \in y} = z$ \Lightning).

    Abbreviate ``$x$ is a successor set'': $\varnothing \in x$ and $(\forall y)(y \in x \implies y^+ \in x)$.
    Note that this is a finite-length formula that characterises an infinite set.
    The axiom of infinity is that there exists a successor set.
    \begin{align*}
        (\exists x)(\varnothing \in x \wedge (\forall y)(y \in x \implies y^+ \in x))
    \end{align*}
    Note that this set is not uniquely defined, but any intersection of successor sets is a successor set.
    So we can construct ``smallest'' successor set, i.e. we can prove
    \begin{align*}
        (\exists x)((x \text{ is a successor set} \wedge (\forall y)(y \text{ is a successor set} \implies  x \subseteq y)))
    \end{align*}
    [Pick any successor set $z$, let $x = \cap \{y \in \mathcal{P}(z) : y \text{ is a successor set}\}$.
    $x$ is then a successor set and if $y$ is any successor set then $x \subset (y \cap z)$].
    We denote the smallest successor set by $\omega$.

    If $x \subseteq \omega$ is a successor set then $x = \omega$, i.e. $(\forall x)(x \subseteq \omega \wedge \varnothing \in x \wedge (\forall y)(y \in x \implies y^+ \in x) \implies x = \omega)$.
    This is true induction.

    It is easy to check that $(\forall x)(x \in \omega \implies x^+ \neq \varnothing)$ and $(\forall x)(\forall y)((x \in \omega \wedge y \in \omega \wedge x^+ = y^+) \implies x = y)$, so $\omega$ satisfies (in $V$) the usual axioms for the natural numbers.

    We can define abbreviations: \\
    ``$x$ is finite'' for $(\exists y)(y \in \omega \wedge (\exists f)(f : x \to y \wedge \text{`$f$ is bijective'}))$; \\
    ``$x$ is countable'' for $(\exists f)(f : x \to \omega \wedge \text{`$f$ is injective'})$.

    \item \vocab{Axiom of Replacement (Rep)} \\
    (Inf) says that there exist sets containing $0, 1, 2, 3, \dots$
    Are there sets containing $\emptyset, \mathcal{P}\emptyset, \mathcal{P}\mathcal{P}\emptyset, \dots$
    There is a function-like\footnote{We have not yet defined functions.} object that sends $0 \mapsto \emptyset$, $1 \mapsto \mathcal{P}\mathcal{P}\emptyset$, \dots

    We need an axiom that the image of a set under a function-like object is a set.

    % Often, we are given an index set $I$ and construct a set $A_i$ for each $i \in I$, then take the collection $\qty{A_i : i \in I}$.
    % In order to write this down, the mapping $i \mapsto A_i$ must be a function, or equivalently, there must be a set $\qty{(i, A_i) : i \in I}$.
    % This is not clear from the other axioms.
    % We would like to say that the image of a set under something that looks like a function (since we do not yet have such a set-theoretic function) is a set.

    \begin{definition}[Class]
        A \vocab{class} is a subset $C$ of a structure $V$ of the language of $\mathsf{ZF}$ s.t. $\exists$ formula $p$ with $\FV(p) = \{x\}$ s.t. $p_V = C$, i.e. $x \in C \iff p(x)$ holds in $V$.
    \end{definition}

    $C$ is a set outside of our model; it may not correspond to a set $x \in V$ inside the model.

    \begin{example} ~\vspace*{-1.5\baselineskip}
        \begin{itemize}
            \item For instance, $V$ is a class, taking $p$ to be $x = x$.
            \item The set of sets of size $1$ is a class, e.g. take $p$ to be $(\exists y)(x = \{y\})$
            \item There is a class of infinite sets, taking $p$ to be `$x$ is not finite'.
            \item For any $t \in V$, the collection of $x$ with $t \in x$ is a class; here, $t$ is a parameter to the class.
            \item Every set $y \in V$ is a class by setting $p$ to be $x \in y$.
        \end{itemize}
    \end{example}

    Say the class $C$ is a \vocab{set} if $(\exists y)(\forall x)(x \in y \iff p)$ holds in $V$.

    \begin{definition}[Proper Class]
        If $C$ is not a set, we say $C$ is a \vocab{proper class}
    \end{definition}

    \begin{example}
        $V$ is a proper class by Russell's paradox.
    \end{example}

    When writing about classes inside $\mathsf{ZF}$, we instead write about their defining formulae, as classes have no direct representation in the language.

    \begin{definition}[Function-Class]
        A \vocab{function-class} is a subset $G$ of $V \times V$ s.t. $\exists$ formula $p$ with $\FV(p) = \{x, y\}$ s.t. $(\forall x)(\forall y)(\forall z)((p \wedge p[z/y]) \implies y = z)$ holds in $V$ and $G = p_V$. \\
        I.e. $(x, y) \in G \iff p(x, y)$ holds in $V$.
    \end{definition}

    \begin{example}
        $G = \{(x, \{x\}) : x \in V\}$ is the fcn class that maps $x$ to $\{x\}$ and is given by $p : (y = \{x\})$.
    \end{example}

    This is intuitively a function whose domain may not be a set.
    This is not a function, for example, every $f$ has a domain which is a set in $V$, and this function has domain $V$ which is not a set.

    We can now define the axiom of replacement: the image of a set under a function-class is a set.
    \begin{align*}
        (\forall t_1)\dots(\forall t_n)[(\forall x)(\forall y)(\forall z)(p \wedge p[z/y] \implies y = z) \implies \\
        (\forall x)(\exists y)(\forall z)(z \in y \Leftrightarrow (\exists t)(t \in x \wedge p[t/x, z/y]))]
    \end{align*}
    for any formula $p$ with $\FV(p) = \{x, y, t_1, \dots, t_n\}$.

    % \begin{example}
    %     For any set $x$, we can form the set $\qty{\qty{t} : t \in x}$, which is the image of $x$ under the function class $t \mapsto \qty{t}$.
    %     This set could alternatively have been formed using the power-set and separation axioms; we will later present some examples of sets built with this axiom that cannot be constructed from the other axioms.
    % \end{example}

    \item \vocab{Axiom of Foundation (Fnd)} or \vocab{regularity} \\
    We require that sets are built out of simpler sets.
    For example, we want to disallow a set from being a member of itself, and similarly forbid $x \in y$ and $y \in x$.
    In general, we want to forbid sets $x_i$ s.t. $x_{i+1} \in x_i$ for each $i \in \mathbb N$.

    Note that if $x \in x$, $\qty{x}$ has no $\in$-minimal element.
    If $x \in y, y \in x$, $\qty{x, y}$ has no $\in$-minimal element.
    In the last example, $\qty{x_0, x_1, \dots}$ has no $\in$-minimal element.

    We now define the axiom of foundation: every nonempty set has an $\in$-minimal element.
    \begin{align*}
        (\forall x)(x \neq \varnothing \implies (\exists y)(y \in x \wedge (\forall z)(z \in x \implies z \not\in y)))
    \end{align*}
    Any model of $\mathsf{ZF}$ without this axiom has a submodel of all of $\mathsf{ZF}$.
\end{enumerate}

This completes the description of the axioms of $\mathsf{ZF}$.
We write $\mathsf{ZFC}$ for $\mathsf{ZF} + \mathsf{AC}$, where $\mathsf{AC}$ is the axiom
\begin{align*}
    (\forall x)(\forall y)(y \in x \implies y \neq \emptyset) \implies (\exists f)(f: x \to \cup x) \wedge (\forall y)(y \in x \implies f(y) \in y)
\end{align*}
% \begin{align*}
%     (\forall f)[f\text{ is a function} \wedge (\forall x)(x \in \dom f \implies f(x) \neq \varnothing) \implies \\
%     (\exists g)(g\text{ is a function} \wedge (\dom g = \dom f) \wedge (\forall x)(x \in \dom f \implies g(x) \in f(x)))]
% \end{align*}

For the rest of this section we work in ZF.

\underline{Aim}: Describe the set-theoretic universe, i.e. any model $V$ of $\mathsf{ZF}$.

\subsection{Transitive sets}

\begin{definition}[Transitive]
    $x$ is \vocab{transitive} if each member of a member of $x$ is a member of $x$.
    \begin{align*}
        (\forall y)(\underbracket{(\exists z)(y \in z \wedge z \in x)}_{y \in \cup x} \implies y \in x)
    \end{align*}
\end{definition}

Equivalently, $\cup x \subseteq x$.

\begin{warning}
    This is \underline{not} the same as saying $\in$ is a transitive relation on $x$.
\end{warning}

\begin{example}
    $\varnothing$ is a transitive set.
    $\qty{\varnothing}$ is also transitive, and $\qty{\varnothing, \qty{\varnothing}}$ is transitive.
    % In general, elements of $\omega$ are transitive.
    % This can be proven by $\omega$-induction (inside a model): $\varnothing$ is transitive, and if $y$ is transitive, $y^+ = y \cup \qty{y}$ is clearly transitive.
\end{example}

\begin{example}
    $\omega$ is transitive.
\end{example}

\begin{proof}
    NTS that $x \subseteq \omega \; \forall x \in \omega$. \\
    Form the set $z = \{y \in \omega : y \subseteq \omega\}$ by (Sep).
    Check $z$ is a successor set, so $z = \omega$, i.e. $\omega$ transitive.

    Similarly, $\{x \in \omega : \text{`$x$ is transitive'}\}$ is also a successor set ($\cup x^+ = x$) so it is $\omega$.
    So every element of $\omega$ is a transitive set.
\end{proof}

\begin{lemma}
    Every set is contained in a transitive set, i.e. $(\forall x)(\exists y)(\text{`$y$ is transitive'} \wedge x \subseteq y)$.
\end{lemma}

\begin{remark}
    This proof takes place inside an arbitrary model of $\mathsf{ZF}$.
    Technically, the statement of the lemma is `let $(V, \in)$ be a model of $\mathsf{ZF}$, then for all sets $x \in V$, $x$ is contained in a transitive set $y \in V$'.
    By completeness, this will show that there is a proof of this fact from the axioms of $\mathsf{ZF}$.

    Note also that once this lemma is proven, any $x$ is contained in a least transitive set by taking intersections, called its \vocab{transitive closure}, written $TC(x)$.
    This holds as any intersection of transitive sets is transitive.
\end{remark}

\underline{Idea}: If $x \subseteq y$ and $y$ transitive then $\bigcup x \subseteq y$ so $\bigcup \bigcup x \subseteq y$, $\bigcup \bigcup \bigcup x \subseteq y$, \dots \\
We want to form $\bigcup \{x, \bigcup x, \bigcup \bigcup x, \dots\}$, this is a set by (Rep).
We need a function-class $0 \mapsto x$, $1 \mapsto \bigcup x$, $2 \mapsto \bigcup \bigcup x$, \dots

\begin{proof}
    We want to define the function-class $p(z,w)$ to be $(z = 0 \wedge w = x) \vee ((\exists t)(\exists u) z = t^+ \wedge w = \bigcup u \wedge p(t,u))$, but this is not a first-order formula.

    Define that $f$ is an \vocab{attempt} to mean that
    \begin{align*}
        (f \text{ is a function}) \wedge (\dom f \in \omega) \wedge (\dom f \neq \varnothing) \wedge (f(0) = x)\, \wedge \\
        (\forall m)(\forall n)\qty((m \in \dom f \wedge n \in \dom f \wedge n = m^+) \implies f(n) = \bigcup f(m))
    \end{align*}
    Then,
    \begin{align*}
        (\forall n)(n \in \omega \implies (\exists f)(f \text{ is an attempt} \wedge n \in \dom f)) \quad (\ast\ast)
    \end{align*}
    can be proven by $\omega$-induction.
    We can similarly prove
    \begin{align*}
        (\forall f)(\forall g)(\forall n)((f, g \text{ are attempts} \wedge (n \in \dom f \cap \dom g)) \implies f(n) = g(n)) \quad (\ast)
    \end{align*}
    by $\omega$-induction.
    We now define the function-class $p = p(y, z)$ to be
    \begin{align*}
        (\exists f)(f \text{ is an attempt} \wedge y \in \dom f \wedge f(y) = z).
    \end{align*}

    By $(\ast)$ we have $(\forall y)(\forall z)(\forall w)((p \wedge p[w/z]) \implies w = z)$.
    By (Rep) we can form $w = \{z : (\exists y)(y \in \omega \wedge p(y, z))\}$ which is $\{x, \bigcup x, \bigcup \bigcup x, \dots\}$.
    Also by (Un) we can form $t = \bigcup w$.

    Then $x \in t$, since $x \in w$ ($\{(0, x)\}$ is an attempt).
    Given $a \in t$, we have $a \in z$ for some $z \in w$.
    Then there's an attempt $f$ and $n \in w$ s.t. $z = f(n)$. \\
    By $(\ast\ast)$ there's an attempt $g$ with $n^+ \in \dom g$.
    Then $n \in \dom g$ so $\bigcup z = \bigcup f(n) = \bigcup g(n)$ by $(\ast)$ and $\bigcup g(n) = g(n^+) \in w$.
    Thus for any $b \in a$, $b \in \cup z \in w$ so $b \in t$, i.e. $t$ transitive.
\end{proof}

Transitive closures allow us to pass from the large universe of sets, which is not a set itself, into a smaller world which is a set closed under $\in$ that contains the relevant sets in question.

\subsection{\texorpdfstring{$\in$}{∈}-induction}
We want the axiom of foundation to capture the idea that sets are built out of simpler sets.
\begin{theorem}[Principle of $\in$-induction]
    For each formula $p$ with free variables $x, t_1, \dots, t_n$,
    \begin{align*}
        (\forall t_1)\dots(\forall t_n)[(\forall x)[(\forall y)(y \in x \implies p(y)) \implies p(x)] \implies (\forall x)p(x)]
    \end{align*}
    where $p(x) = p$ and $p(y) = p[y/x]$.
\end{theorem}

\begin{proof}
    Fix $t_1, \dots, t_n$ and assume $(\forall x)((\forall y)(y \in x \implies p(y)) \implies p(x))$ holds, we want to show $(\forall x)p(x)$.
    Assume not, i.e. $\exists x$ s.t. $\neg p(x)$.
    We want to look at the set $\qty{t : \neg p(t)}$ and take an $\in$-minimal element, but this may not be a set, e.g. for $p = (x \neq x)$.

    Choose a transitive set $t$ s.t. $x \in t$, e.g. $t = TC(\qty{x})$.
    By (Sep) form the set $u = \qty{y \in t : \neg p(y)}$; this is clearly a set in the model, and $u \neq \varnothing$ as $x \in u$.
    Let $z$ be an $\in$-minimal element of $u$ (exists by (Fnd)).
    If $y \in z$, then $y \in t$ (as $t$ transitive) and $y \notin u$ (by minimality), so $p(y)$.
    By assumption $p(z)$ holds \Lightning\ of $z \in u$.
\end{proof}
The name of this theorem should be read `epsilon-induction', even though the membership relation is denoted $\in$ and not $\epsilon$.

The principle of $\in$-induction is equivalent to the axiom of foundation (Fnd) in the presence of the other axioms of $\mathsf{ZF}$.

\underline{Clever Idea}: We say that $x$ is \vocab{regular} if $(\forall y)(x \in y \implies y \text{ has a $\in$-minimal element})$ (this defn is the clever part).
The axiom of foundation is equivalent to the assertion that every set is regular.
Given $\in$-induction, we can prove every set is regular.
Fix some $x$ and suppose $(\forall y \in x)(y \text{ is regular})$; we need to show $x$ is regular.
For a set $z$ with $x \in z$, if $x$ is minimal in $z$, $x$ is clearly regular as required.
If $x$ is not minimal in $z$, there exists $y \in x$ s.t. $y \in z$.
So $z$ has a minimal element as $y$ is regular.
Hence $x$ is regular.

\subsection{\texorpdfstring{$\in$}{∈}-recursion}
We want to be able to define $f(x)$ given $f(y)$ for all $y \in x$, i.e. $f(x)$ depends on $\eval{f}_x$.

\begin{theorem}[$\in$-recursion Theorem]
    Let $G$ be a function-class, i.e. $(x,y) \in G$ iff $p(x,y)$ for some formula $p$.
    Suppose that $G$ is defined for all sets.
    Then there is a function-class $F$ defined for all sets by a formula $q(x,y)$ s.t.
    \begin{align*}
        (\forall x)\qty(F(x) = G\qty(\eval{F}_x))
    \end{align*}
    Moreover, this $F$ is unique.
\end{theorem}

Note that $\eval{F}_x = \qty{(y, F(y)) : y \in x}$ is a set by (Rep) and is the image of the set $x$ under the fcn class $s \mapsto (s, F(s))$.

\begin{proof}
    \underline{Existence}:
    Define that $f$ is an \vocab{attempt} if
    \begin{align*}
        f \text{ is a function} \wedge \dom f \text{ is transitive} \wedge (\forall x)\qty(x \in \dom f \implies f(x) = G\qty(\eval{f}_x)) \tag{$\ast$}
    \end{align*}
    Note that $\eval{f}_x$ is defined as $\dom f$ is transitive.
    Then,
    \begin{align*}
        (\forall x)(\forall f)(\forall f')(f, f' \text{ are attempts} \wedge x \in \dom f \cap \dom f' \implies f(x) = f'(x))
    \end{align*}
    by $\in$-induction: if $f(y) = f'(y)$ for all $y \in x$, then $f(x) = f'(x)$.
    Also,
    \begin{align*}
        (\forall x)(\exists f)(f \text{ is an attempt} \wedge x \in \dom f)
    \end{align*}
    by $\in$-induction.

    Fix $x$.
    Assume every $y \in x$ is in the domain of some attempt, which is then defined on $TC(\qty{y})$ and unique by $(\ast)$, say $f_y$.
    Then $f' = \bigcup \underbracket{\qty{f_y : y \in x}}_{\text{a set by (Rep)}}$ is an attempt by $(\ast)$.
    Finally, $f = f' \cup \qty{\qty(x, G\qty(f'))}$ is an attempt defined at $x$.
    Note that $\eval{f}_x = f'$. \\
    We can then take $q(x,y)$ to be the formula
    \begin{align*}
        (\exists f)(f \text{ is an attempt} \wedge x \in \dom f \wedge f(x) = y)
    \end{align*}
    This defines the function-class $F$ as required.

    \underline{Uniqueness}: Assume $F, F'$ satisfy the theorem, then we have $(\forall x)(F(x) = F'(x))$ by $\in$-induction.
    If $F(y) = F'(y) \; \forall y \in x$, then $\eval{F}_x = \eval{F'}_x$, then $F(x) = F'(x)$.
\end{proof}

\subsection{Well-founded relations}
Note the similarity between the proofs of $\in$-induction and $\in$-recursion and the proofs of induction and recursion on ordinals.
These proofs are not specific to the relation $\in$; we only used some of its properties.

\begin{definition}[Well-Founded]
    $r$ is \vocab{well-founded} if $(\forall x)(x \neq \varnothing \implies (\exists y)(y \in x \wedge (\forall z)(z \in x \implies \neg z r y)))$, i.e. every nonempty set has an $r$-minimal element.
\end{definition}

\begin{example}
    If $r$ is $(x \in y)$, then $r$ is the $\in$-relation which is well-founded by (Fnd).
\end{example}

\begin{definition}[Local]
    $r$ is \vocab{local} if $(\forall x)(\exists y)(\forall z)(z \in y \wedge z r x\footnote{$zrx = r(z, x)$})$, i.e. the $r$-predecessors of $x$ form a set.
\end{definition}

\begin{example}
    Clearly $\in$.
\end{example}

`local' is needed for $r$-closure.
Then we can prove $r$-induction and $r$-recursion.

We can restrict $r$ to a class or set.
If $r$ is a relation on a set $a$, then for any $x \in a$, $\qty{y \in a: y r x}$ is a set by (Sep).
So we only need well-foundedness to have $r$-induction and $r$-recursion on $a$.

Is this really more general than $\in$?
No, provided we also assume that $r$ is \vocab{extensional} on $a$.

\begin{definition}[Extensional]
    $r$ is \vocab{extensional} on $a$ if
    \begin{align*}
        (\forall x \in a)(\forall y \in a)((\forall z \in a)(zrx \Leftrightarrow zry) \implies x = y)
    \end{align*}
\end{definition}
This is just the axiom of extensionality applied to the relation $r$.

% Therefore, $p$-induction and $p$-recursion hold for all relation-classes $p$ that are well-founded and local.
% In particular, if $r$ is a well-founded relation on a set $a$, it is clearly local and hence we have $r$-induction and $r$-recursion.
% The theorems about induction and recursion on ordinals are therefore special cases of this, as a well-ordering is precisely a well-founded total order.

% On the set $\qty{a, b, c}$, let $r$ be the relation $arb, brc$.
% Choosing $a' = \varnothing, b' = \qty{\varnothing}, c' = \qty{\qty{\varnothing}}$, the map $f \colon \qty{a, b, c} \to \qty{a', b', c'}$ given by $x \mapsto x'$ is a bijection with a transitive set s.t. $xry$ if and only if $f(x) \in f(y)$.
% This models the relation $r$ by $\in$.
% The relation $r$ is extensional.

\begin{theorem}[Mostowski's Collapsing Theorem]
    Let $r$ be a well-founded and extensional relation on a set $a$.
    Then, $\exists$ a transitive set $b$ and a bijection $f \colon a \to b$ s.t.
    \begin{align*}
        (\forall x \in a)(\forall y \in a)(x r y \Leftrightarrow f(x) \in f(y))
    \end{align*}
    Moreover, $b$ and $f$ are unique.
\end{theorem}

This is an analogue of subset collapse from the section on ordinals.
Transitive sets are playing the role of initial segments.
Note that the well-foundedness and extensionality conditions are clearly necessary for the theorem, consider $(\mathbb Z, <)$ or $(\qty{a,b,c,},<)$ with $a<b, a<c$ for counterexamples.

\begin{proof}
    By $r$-recursion on $a$, there's a function class $f$ s.t. $\forall x \in a$, $f(x) = \{f(y) : y \in a \wedge y r x \}$.
    Note that $f$ is a function, not just a fcn class since $\qty{(x, f(x)) : x \in a}$ is a set by (Rep).

    Then $b = \qty{f(x) : x \in a}$ is a set by (Rep). \\
    $b$ is transitive: Let $z \in b$ and $w \in z$.
    There's $x \in a$ s.t. $z = f(x)$, and so a $y \in a$ s.t. $y r x$ and $w = f(y) \in b$.

    Clearly $f$ surjective and $\forall x, y \in a$, $xry \implies f(x) \in f(y)$.

    It remains to show that $f$ is injective, it will then follow that $\forall x, y \in a$, $f(x) \in f(y) \implies x r y$.
    Indeed, if $f(x) \in f(y)$, then $f(x) = f(z)$ for some $z \in a$ with $z r y$.
    Since $f$ is injective, $x = z$ so $x r y$.

    We will show
    \begin{align*}
        (\forall x \in a)(\forall x' \in a)(f(x') = f(x) \implies x' = x)
    \end{align*}
    by $r$-induction on $x$.

    Fix $x \in a$ and assume $f$ is injective at $s$ whenever $s \in a$ and $srx$.
    Assume $f(x) = f(y)$ for some $y \in a$, i.e. $\qty{f(s): s \in a \wedge s r x} = \qty{f(t) : t \in a \wedge try}$.
    Since $f$ is injective at every $s \in a$ with $srx$, it follows that $x = y$.

    \underline{Uniqueness}: Assume $(b, f)$ and $(b', f')$ both satisfy the theorem.
    We prove $(\forall x \in a)(f(x) = f'(x))$ by $r$-induction.
    Fix $x \in a$ and assume $f(y) = f'(y)$ whenever $y \in a \wedge y r x$.
    If $z \in f(x)$ then $z \in b$ ($b$ transitive), so $z = f(y)$ for some $y \in a$ with $y r x$.
    Then $z = f(y) = f'(y)$ (induction hypothesis).
    Then $z = f'(y) \in f'(x)$.
    Similarly, if $z \in f'(x)$ then $z \in f(x)$.
    By (Ext), $f(x) = f'(x)$.
\end{proof}

In particular, every well-ordered set has a unique order isomorphism to a unique transitive set well-ordered by $\in$.

\begin{definition}[Ordinal]
    An \vocab{ordinal} is a transitive set well-ordered by $\in$. (Equivalently, linearly ordered by $\in$ since $\in$ is well-founded by (Fnd)).
\end{definition}

Note that, if $a$ a set and $r$ a well-ordering on $a$, then $r$ is well-founded and extensional (if $x, y \in a$ and $x \neq y$, then $xry$ or $yrx$, but not both).
By Mostowski, $\exists$ a transitive set $b$ and bijection $f : a \to b$ s.t. $x r y \iff f(x) \in f(y)$, i.e. $f: (a, r) \to (b, \in)$ is an order isomorphism.
So $b$ is an ordinal.
So by Mostowski, every well-ordered set, $x$, is order-isomorphic to a unique ordinal, called the order type of $x$.

We let $ON$ denote the class of ordinals (given by formula `$x$ is an ordinal').
It is a proper class by Buralti-Forti.

\begin{proposition}
    Let $\alpha, \beta \in ON$ and $a$ a set of ordinals.
    \begin{enumerate}
        \item Every member of $\alpha$ is an ordinal
        \item $\beta \in \alpha \iff \beta$ is o.i. to an i.s. of $\alpha$ ($\beta < \alpha$).
        \item $\alpha \in \beta$ or $\alpha = \beta$ or $\beta \in \alpha$.
        \item $\alpha^+ = \alpha \cup \qty{\alpha}$ ($+$ in the sense of section 2).
        \item $\cup a$ is an ordinal and $\cup a = \sup a$.
    \end{enumerate}
\end{proposition}

\begin{remark}
    (2) says that $\alpha$ really \underline{is} the set of ordinals $< \alpha$; \\
    (3) says that $\in$ linearly orders the class $ON$; \\
    (4) resolves the clash of notation $x^+$ in section $2$ and $5$.
    According to the definition in section $2$, $\alpha^+$ is the unique (up to order-isomorphism) well-ordered set that consists of $\alpha$ as a proper initial segment and one extra element that is a maximum.
    By Mostowski, this well-ordered set is order-isomorpic to a unique ordinal (its order-type).
    (4) shows that this ordinal is the successor of the set $\alpha$ as defined in this section.
    In particular, this shows that the successor of an ordinal is an ordinal; \\
    (5) now shows that any set of well-ordered sets has an upper bound.
\end{remark}

\begin{proof}
    \begin{enumerate}
        \item Let $\gamma \in \alpha$.
        Then $\gamma \subseteq \alpha$ ($\alpha$ is transitive) and hence $\in$ linearly orders $\gamma$\footnote{$\in$ linearly orders $\alpha$ and $\gamma$ a subset so $\eval{\in}_\gamma$ linearly orders it.}.
        Given $\eta \in \delta$, $\delta \in \gamma$ then $\delta \in \alpha$ and so $\eta \in \alpha$ ($\alpha$ is transitive).
        Since $\in$ is transitive\footnote{As $\in$ a well ordering.} on $\alpha$, we have $\eta \in \gamma$.
        So $\gamma$ is a transitive set, so $\gamma$ is an ordinal.
        \item If $\beta \in \alpha$, then $I_\beta = \qty{\gamma \in \alpha : \gamma \in\footnote{We are well-ordered by $\in$ not $<$ so we use $\in$ to define initial segments} \beta} = \beta$ as $\beta \subset \alpha$ by transitivity of $\alpha$, so $\beta < \alpha$.
        Any proper i.s. of $\alpha$ is of the form $I_\gamma$ for some $\gamma \in \alpha$.
        So $\beta < \alpha \implies \beta \in \alpha$.
        \item Done by (2)
        \item Let $\beta = \alpha \cup \qty{\alpha}$(successor of $\alpha$ in section 5).
        If $\gamma \in \beta$, then either $\gamma = \alpha \subseteq \beta$ or $\gamma \in \alpha$, so $\gamma \subseteq \alpha \subseteq \beta \implies \beta$ is transitive, linearly ordered by $\in$ (by (3)), and $\alpha$ is the greatest element.
        So $\beta = \alpha^+$ in section 2.
        \item $\cup a$ is a union of transitive sets, hence transitive.
        Every member of $\cup a$ is an ordinal, so $\cup a$ linearly ordered by $\in$ (by (3)). \\
        If $\gamma \in a$, then $\gamma \subseteq \cup a$ so either $\gamma = \cup a$ or $\gamma \in \cup a$ (by (3)), i.e. $\gamma \leq \cup a$. \\
        If $\gamma \leq \delta$ for all $\gamma \in a$, then $\gamma = \delta$ or $\gamma \in \delta$ for all $\gamma \in a$, i.e. $\gamma \subseteq \delta$ (by (3)).
        So $\cup a \subseteq \delta$ i.e. $\cup a \leq \delta$.
        [If $\gamma < \cup a$, then $\gamma \in \cup a$, i.e. $\gamma \in \delta$ for some $\delta \in a$, i.e. $\gamma < \cup a$ (by (3)), so $\gamma$ is not an upper bound for $a$.]
    \end{enumerate}
\end{proof}

\begin{example}
    $0 = \emptyset \in ON$, hence $n \in ON$ for all $n \in \omega$ (by $\omega$-induction).
    $\omega$ is transitive, so $\cup \omega \subseteq \omega$.
    If $n \in \omega$, then $n \in n^+ \subseteq \omega$, so $n \in \cup \omega$.
    So $\omega \subseteq \cup \omega \implies \omega = \cup \omega$ is an ordinal and $\omega = \sup \omega$.
\end{example}

\subsection{The universe of sets}

\underline{Idea}: Everything is build up from $\emptyset$ using $\mathcal{P}$ and $\cup$.
We can have $V_0 = \emptyset$, $V_1 = \mathcal{P} \emptyset = \qty{\emptyset}$, $V_2 = \mathcal{P} \mathcal{P} \emptyset = \qty{\emptyset, \qty{\emptyset}}$, \dots, $V_\omega = \cup \qty{V_0, V_1, \dots}$, $V_{\omega + 1} = \mathcal{P} V_\omega$ etc.

It will be (Fnd) that guarantees that every set appears in a $V_\alpha$.

Define sets $V_\alpha$ for each ordinal $\alpha \in ON$ by $\in$-recursion:
\begin{itemize}
    \item $V_0 = \varnothing$;
    \item $V_{\alpha+1} = \mathcal P(V_\alpha)$;
    \item $V_\lambda = \bigcup \qty{V_\alpha : \alpha < \lambda}$ for a nonzero limit ordinal $\lambda$.
\end{itemize}
This can be viewed as a well-founded recursion on ordinals, or $\in$-recursion on the universe but mapping non-ordinals to $\varnothing$.
The sets $V_\alpha$ form the \vocab{von Neumann Hierarchy}.

\underline{Aim}: Show that every set is contained in some $V_\alpha$.

\begin{lemma} \label{lem:5-6}
    $V_\alpha$ is transitive $\forall \alpha \in ON$.
\end{lemma}

\begin{proof}
    We show this by induction on $\alpha$. \\
    Clearly $V_0 = \varnothing$ is transitive. \\
    Suppose $V_\alpha$ is transitive.
    If $x \in V_{\alpha^+}$ then $x \subseteq V_\alpha$.
    If $y \in x$, then $y \in V_\alpha$.
    So by the induction hypothesis, $y \subseteq V_\alpha$.
    So every $y \in x$ has $y \in \mathcal{P}(V_\alpha) = V_{\alpha^+}$ thus $V_{\alpha^+}$ is transitive. \\
    Now suppose $\lambda \neq 0$ is a limit ordinal, if $x \in V_\lambda$ then $\exists \gamma < \alpha$ s.t. $x \in V_\gamma$.
    By the induction hypothesis, $V_\gamma$ is transitive, so $x \subseteq V_\gamma \subseteq V_\lambda$.
\end{proof}

\begin{lemma} \label{lem:5-7}
    Let $\alpha \leq \beta$.
    Then $V_\alpha \subseteq V_\beta$.
\end{lemma}

\begin{proof}
    We show this by induction on $\beta$ for a fixed $\alpha$. \\
    If $\beta = 0$, $\alpha \leq \beta \implies \alpha = 0$ so $V_\alpha = V_\beta$. \\
    If $\beta = \gamma^+$: If $\alpha = \beta$ then $V_\alpha = V_\beta$. \\
    If $\alpha < \beta$, then $\alpha \leq \gamma$, so by IH $V_\alpha \subseteq V_\gamma$.
    If $x \in V_\gamma$ then $x \subseteq V_\gamma$ ($V_\gamma$ transitive) so $x \in \mathcal{P}(V_\gamma) = V_\beta$.
    Thus $V_\gamma \subseteq V_{\gamma^+} = V_\beta$ and hence $V_\alpha \subseteq V_\beta$. \\
    If $\beta \neq 0$ a limit and $\alpha < \beta$ then $V_\alpha \subseteq V_\beta$ by defn.
    Limits are trivial.
\end{proof}

\begin{theorem}
    The von Neumann hierarchy exhausts the set-theoretic universe $V\footnote{$V = \cup_{\alpha \in ON} V_\alpha$.}$, i.e. $(\forall x)(\exists \alpha \in ON)(x \in V_\alpha)$.
    `Every set $x$ belongs to $V_\alpha$ for some $\alpha$'.
\end{theorem}

If we could construct the set $V$ defined as the union of the $V_\alpha$ over all ordinals $\alpha$, $V$ would be a model of $\mathsf{ZF}$.

\begin{remark}
    If $x \in V_\alpha$ then $x \subseteq V_\alpha$ by \cref{lem:5-6}. \\
    If $x \subseteq V_\alpha$ then $x \in \mathcal{P}(V_\alpha) = V_{\alpha+1}$.
    If $\exists \alpha \in ON$ s.t. $x \subseteq V_\alpha$ define the \vocab{rank} of $x$ to be the least such $\alpha$.

    For example, the rank of $\emptyset$ is 0, the rank of 1 is 1, the rank of $\omega$ is $\omega$, and in general the rank of any ordinal $\alpha$ is $\alpha$.
    Intuitively, the rank of a set is the time at which it was created.
\end{remark}

\begin{proof}
    We proceed by $\in$-induction on $x$.
    Fix $x$ and assume $\forall y \in x$, $y \subseteq V_\alpha$ for some $\alpha \in ON$.
    So $\forall y \in x$, $y \subseteq V_{\rank(y)}$. \\
    Let $\alpha = \sup \underbracket{\qty{\rank(y)^+ : y \in x}}_{\text{a set by (Rep)}}$. \\
    We'll show $x \subseteq V_\alpha$.
    If $y \in x$, then $y \subseteq V_{\rank(y)}$, so $y \in \mathcal{P}(V_{\rank(y)}) = V_{\rank(y)^+} \subseteq V_\alpha$ by \cref{lem:5-7}.
    So $x \subseteq V_\alpha$ as required.
\end{proof}

\begin{corollary}
    For every set $x$, $\rank(x) = \sup \qty{\rank(y)^+ : y \in x}$.
\end{corollary}

\begin{proof}
    ``$\leq$' follows form the proof above. \\
    ``$\geq$': We first show that $x \in V_\alpha \implies \rank(x) < \alpha$. \\
    $\alpha = 0$: $\checkmark$ \\
    $\alpha = \beta^+$: $x \in \mathcal{P}(V_\beta)$ so $x \subseteq V_\beta$ so $\rank(x) \leq \beta < \alpha$. $\checkmark$ \\
    $\alpha \neq 0$ a limit: $x \in V_\alpha \implies \exists \gamma < \alpha$ s.t. $x \in V_\gamma$ so $\rank(x) < \gamma < \alpha$. $\checkmark$.

    Now let $\alpha = \rank(x)$.
    Then $x \subseteq V_\alpha$, so for $y \in x$, $y \in V_\alpha$ and so $\rank(y) < \alpha$.
    Hence $\sup \qty{\rank(y)^+ : y \in x} \leq \alpha$.
\end{proof}

\begin{example}
    $\rank(\alpha) = \alpha \quad \forall \alpha \in ON$. \\
    By induction:
    \begin{align*}
        \rank(\alpha) &= \sup \qty{\rank(\beta)^+ : \beta < \alpha} \\
        &= \sup\qty{\beta^+ : \beta < \alpha} \text{ by IH} \\
        &= \alpha.
    \end{align*}
\end{example}

The ordinals can be viewed as the backbone of the universe of sets; each $V_\alpha$ can be thought of as resting on the ordinal $\alpha$.

\begin{example}
    The rank of $\qty{\qty{2, 3}, 6}$ is
    \begin{align*}
        \sup\qty{\mathrm{rank}\qty{2, 3} + 1, 6 + 1} = \sup\qty{5, 7} = 7
    \end{align*}
\end{example}