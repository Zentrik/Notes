% xelatex -job-name="preamble" --ini "&xelatex preamble.tex\dump"
% lualatex doesn't work with tikz for some reason.

% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\def\encodingdefault{OT1}\normalfont
\documentclass[]{scrartcl}

\usepackage{amsmath,amssymb, amsfonts}
\usepackage{mathrsfs}
\usepackage{mathtools}
\usepackage{lmodern}
\usepackage{ifxetex,ifluatex}

% Use upquote if available, for straight quotes in verbatim environments
\usepackage{upquote}
\usepackage[]{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts

\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage[usenames,svgnames,dvipsnames,table]{xcolor}
\usepackage{xurl} % add URL line breaks if available
\usepackage[colorlinks=true]{hyperref}
\hypersetup{urlcolor=RoyalBlue,linkcolor=RoyalBlue,citecolor=RoyalBlue}
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{}
\usepackage{nameref,cleveref}
\urlstyle{same} % disable monospaced font for URLs
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\graphicspath{{./figures/}}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\ifluatex
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage[]{natbib}
\bibliographystyle{plainnat}

\usepackage{amsthm}
\usepackage{thmtools}
\usepackage{mdframed}

% Theorem Setup
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newif\ifadamfancyproofs\adamfancyproofstrue
\newif\ifadamnoindent\adamnoindenttrue
\newif\ifadamfancytheorems\adamfancytheoremstrue

% Colours

\definecolor{examplebg}{HTML}{FEF2F1}
\definecolor{examplefg}{HTML}{874120}
\definecolor{definitionbg}{HTML}{F2F8F5}
\definecolor{definitionfg}{HTML}{00A190}
\definecolor{theorembg}{HTML}{F3ECF4}
\definecolor{theoremfg}{HTML}{242476}
\definecolor{proofbg}{HTML}{F7F7F7}
\definecolor{prooffg}{HTML}{808080}

% \AtBeginDocument{%
%   \setlength{\abovedisplayskip}{0.25\abovedisplayskip}%
%   \setlength{\belowdisplayskip}{0.4\belowdisplayskip}%
%   \setlength{\abovedisplayshortskip}{0.25\abovedisplayshortskip}%
%   \setlength{\belowdisplayshortskip}{0.4\belowdisplayshortskip}%
% }

\ifadamnoindent
\mdfsetup{
    skipabove=0.8\baselineskip,
    skipbelow=0.3\baselineskip,
    % innertopmargin=1\baselineskip,
    innerbottommargin=8pt,
    hidealllines=true
}
\else
\mdfsetup{
    skipabove=0.5\baselineskip,
    skipbelow=0.5\baselineskip,
    innertopmargin=5pt,
    innerbottommargin=8pt,
    hidealllines=true
}
\fi


% Proof
\mdfdefinestyle{mdproofbox}{
    skipabove=0.4\baselineskip,
    skipbelow=0.3\baselineskip,
    backgroundcolor=proofbg,
    linecolor=prooffg,
    linewidth=1.5pt,
    topline=false,
    innerbottommargin=6pt,
    rightline=false,
    bottomline=false,
    leftline=true
}

% Example
\declaretheoremstyle[
    headfont=\sffamily\bfseries\color{examplefg},
    mdframed={
        backgroundcolor=examplebg,
        nobreak=false
    },
    headpunct={\\[3pt]},
    postheadspace={3pt}
]{thmexamplebox}

% Answer
\declaretheoremstyle[
    headfont=\sffamily\bfseries\color{definitionfg},
    mdframed={
        backgroundcolor=definitionbg,
        nobreak=false
    },
    headpunct={\\[3pt]},
    postheadspace={3pt}
]{thmanswerbox}


% Definition
\declaretheoremstyle[
    headfont=\sffamily\bfseries\color{definitionfg},
    mdframed={backgroundcolor=definitionbg},
    headpunct={\\[3pt]},
    postheadspace={3pt}
]{thmdefinitionbox}

% Theorem
\declaretheoremstyle[
    headfont=\sffamily\bfseries\color{theoremfg},
    mdframed={backgroundcolor=theorembg},
    headpunct={\\[3pt]},
    postheadspace={3pt}
]{thmtheorembox}

\ifadamfancytheorems
    \declaretheorem[style=thmtheorembox,name=Theorem,numberwithin=section]{theorem}
    \declaretheorem[style=thmtheorembox,name=Lemma,numberwithin=section]{lemma}
    \declaretheorem[style=thmtheorembox,name=Fact,numberwithin=section]{fact}
    \declaretheorem[style=thmtheorembox,name=Proposition,numberwithin=section]{proposition}
    \declaretheorem[style=thmtheorembox,name=Corollary,numberwithin=section]{corollary}
    \declaretheorem[style=thmexamplebox,name=Example,numberwithin=section]{example}
    \declaretheorem[style=thmdefinitionbox,name=Definition,numberwithin=section]{definition}
    \declaretheorem[style=thmdefinitionbox,name=Axiom,numberwithin=section]{axiom}
    \declaretheorem[style=thmtheorembox,name=Axiom,numberwithin=section]{axiomthm}
    \declaretheorem[style=thmdefinitionbox,name=Law,numberwithin=section]{law}
    \declaretheorem[style=thmtheorembox,name=Theorem,numbered=no]{theorem*}
    \declaretheorem[style=thmtheorembox,name=Lemma,numbered=no]{lemma*}
    \declaretheorem[style=thmtheorembox,name=Claim,numberwithin=section]{claim}
    \declaretheorem[style=thmtheorembox,name=Fact,numbered=no]{fact*}
    \declaretheorem[style=thmtheorembox,name=Proposition,numbered=no]{proposition*}
    \declaretheorem[style=thmtheorembox,name=Corollary,numbered=no]{corollary*}
    \declaretheorem[style=thmexamplebox,name=Example,numbered=no]{example*}
    \declaretheorem[style=thmexamplebox,name=Question,numbered=no]{question}
    \declaretheorem[style=thmanswerbox,name=Answer,numbered=no]{answer}
    \declaretheorem[style=thmdefinitionbox,name=Definition,numbered=no]{definition*}
    \declaretheorem[style=thmdefinitionbox,name=Axiom,numbered=no]{axiom*}
    \declaretheorem[style=thmtheorembox,name=Axiom,numbered=no]{axiomthm*}
\else
    \newtheorem{theorem}{Theorem}[section]
    \newtheorem{lemma}[theorem]{Lemma}
    \newtheorem{fact}[theorem]{Fact}
    \newtheorem{corollary}[theorem]{Corolarry}
    \newtheorem{proposition}[theorem]{Proposition}
    \newtheorem*{theorem*}{Theorem}
    \newtheorem*{lemma*}{Lemma}
    \newtheorem*{fact*}{Fact}
    \newtheorem*{corollary*}{Corollary}
    \newtheorem*{proposition*}{Proposition}

    \theoremstyle{definition}

    \newtheorem{example}[theorem]{Example}
    \newtheorem{definition}[theorem]{Definition}
    \newtheorem{axiom}[theorem]{Axiom}
    \newtheorem*{example*}{Example}
    \newtheorem*{definition*}{Definition}
    \newtheorem*{axiom*}{Axiom}
\fi

\ifadamfancyproofs
\surroundwithmdframed[style=mdproofbox]{proof}
\else
\AtBeginEnvironment{proof}{\vspace{-0.5\baselineskip}}
\fi

\newtheorem*{problem*}{Problem}

\theoremstyle{definition}

\newtheorem{conjecture}[theorem]{Conjecture}
\newtheorem{case}[theorem]{Case}
\newtheorem{exercise}[theorem]{Exercise}
\newtheorem{problem}[theorem]{Problem}
\newtheorem*{conjecture*}{Conjecture}
\newtheorem*{answer*}{Answer}
\newtheorem*{case*}{Case}
\newtheorem*{joke*}{Joke}
\newtheorem*{question*}{Question}
\newtheorem*{exercise*}{Exercise}
\newtheorem*{notation}{Notation}

\theoremstyle{remark}
\newtheorem{remark}{Remark}
\newtheorem*{note}{Note}

% Fancy Section and Chapter Heads 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\makeatletter
\@ifundefined{chapter}{}{
\addtokomafont{partprefix}{\rmfamily}
\renewcommand*{\partformat}{
    \color{purple}
    \scalebox{2.5}{\thepart}
    \enlargethispage{2em}
}

\addtokomafont{chapterprefix}{\raggedleft}
\RedeclareSectionCommand[beforeskip=0.5em]{chapter}
\RedeclareSectionCommand[
  beforeskip=-.5\baselineskip,
  afterskip=.25\baselineskip]{subsubsection}
\renewcommand*{\chapterformat}{\mbox{%
    \scalebox{1.5}{\chapappifchapterprefix{\nobreakspace}}%
    \scalebox{2}{\color{purple}\thechapter}
    \enskip
}}
}
\makeatother

\renewcommand*{\sectionformat}%
    {\color{purple}\S\thesection\enskip}
\renewcommand*{\subsectionformat}%
    {\color{purple}\S\thesubsection\enskip}
\renewcommand*{\subsubsectionformat}%
    {\color{purple}\S\thesubsubsection\enskip}
\KOMAoptions{numbers=noenddot}

\newenvironment{aside}[1]{
    \rule{\textwidth}{0.025cm}
    \vspace{-1.75\baselineskip}
    \subsection*{#1}}
{\rule{\textwidth}{0.025cm}}

\usepackage{tikz}

\usepackage{ marvosym }

\usepackage{enumitem}
\newenvironment{symenum}
 {\enumerate[label=\arabic*\noexpand\thisenumsymbol.,align=left,ref=\arabic*\noexpand\thisenumsymbol]}
 {\endenumerate}
\newcommand\thisenumsymbol{}
\newcommand\itemsymbol[1]{%
  \renewcommand{\thisenumsymbol}{#1}%
  \item
}

\usepackage{nicematrix}
\usepackage{tcolorbox}

\usepackage{pdfpages}

\usepackage{wrapfig}

\usepackage{cancel}

\newcommand\hcancel[2][black]{\setbox0=\hbox{$#2$}%
\rlap{\raisebox{.45\ht0}{\textcolor{#1}{\rule{\wd0}{1pt}}}}#2} 

\newcommand\Ccancel[2][black]{
    \let\OldcancelColor\CancelColor
    \renewcommand\CancelColor{\color{#1}}
    \cancel{#2}
    \renewcommand\CancelColor{\OldcancelColor}
}

\makeatletter
\def\mathcolor#1#{\@mathcolor{#1}}
\def\@mathcolor#1#2#3{%
  \protect\leavevmode
  \begingroup
    \color#1{#2}#3%
  \endgroup
}
\makeatother

\usepackage{centernot}
\usepackage[super]{nth}

\usetikzlibrary{fadings}
\usetikzlibrary{patterns}
\usetikzlibrary{shadows.blur}
\usetikzlibrary{shapes}

% Fix duplicated footnotes in math mode in mdframed box
% \usepackage{amsmath,etoolbox}

\makeatletter
\let\original@footnote\footnote
\newcommand{\align@footnote}[1]{%
  \ifmeasuring@
    \chardef\@tempfn=\value{footnote}%
    \footnotemark
    \setcounter{footnote}{\@tempfn}%
  \else
    \iffirstchoice@
      \original@footnote{#1}%
    \fi
  \fi}
\pretocmd{\start@align}{\let\footnote\align@footnote}{}{}
\makeatother


\usepackage{bm}

\allowdisplaybreaks

% Small Macros
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\vocab}[1]{\textbf{\color{blue} #1}}

% Math Symbols
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Special sets
\newcommand{\C}{\mathbb{C}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\F}{\mathbb{F}}
\newcommand{\PP}{\mathbb{P}}
\newcommand{\EE}{\mathbb{E}}
\newcommand{\GL}{\operatorname{GL}}
\newcommand{\SL}{\operatorname{SL}}
\newcommand{\OO}{\operatorname{O}}
\newcommand{\SO}{\operatorname{SO}}
\newcommand{\DD}{\mathcal{D}}
\newcommand{\FF}{\mathcal{F}}
\newcommand{\BB}{\mathcal{B}}

\newcommand{\Var}{\operatorname{Var}}
\newcommand{\Cov}{\operatorname{Cov}}

\newcommand{\dd}{\; \mathrm{d}}
\newcommand{\indep}{\perp\!\!\!\perp}